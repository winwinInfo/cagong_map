<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카공여지도</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Dongle:wght@300;400;700&family=Noto+Sans+KR:wght@400;700&family=Jua&family=Gasoek+One&family=Do+Hyeon&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js"></script>

</head>
<body>
    <div class="container">
        <!-- 사이드바 영역 -->
        <div class="sidebar" id="sidebar">
            <!-- 헤더 영역 -->
            <div class="header" onclick="toggleSidebar()">
                <h1 style="font-family: 'Jua', sans-serif; margin-top: 5px; margin-bottom: 5px;">카공여지도</h1>
            </div>
            <!-- 학교 선택 영역 -->
            <div class="school-select-container" style="padding-bottom: 0px;">
                <select id="school-select" onchange="moveToSchool()">
                    <option value="" data-message="" data-link="">학교를 선택하세요</option>
                    <option value="성균관대" data-message="카공 커뮤니티" data-link="https://open.kakao.com/o/gUqaKEvg">성균관대</option>
                    <option value="경희대" data-message="카공 커뮤니티" data-link="https://open.kakao.com/o/gQvXihxg">경희대</option>
                    <option value="한국외대" data-message="카공 커뮤니티" data-link="https://open.kakao.com/o/gQvXihxg">한국외대</option>
                </select>
            </div>
            <!-- 검색 영역 -->
            <div class="search-container">
                <input type="text" id="search" placeholder="카페명을 검색하세요" onclick="expandSidebar()">
                <button id="search-button" aria-label="Search" onclick="expandSidebar()" style="padding-top: 5px; padding-bottom: 5px; padding-right: 5px; padding-left: 5px;">
                    <span class="material-symbols-outlined">search</span>
                </button>
            </div>
            <!-- 검색 결과 영역 -->
            <div id="search-results" class="search-results">
                <ul id="results-list" style="margin-top: 0px; margin-bottom: 0px;"></ul>
            </div>
            <!-- 카페 정보 영역, 처음에는 숨김 처리 -->
            <div class="info hidden" id="cafe-info" style="padding-top: 5px;">
                <h2 style="margin-top: 0; margin-bottom: 10px;" id="cafe-name"></h2>
                <p id="cafe-message" style="font-family: 'Nanum Pen Script', cursive; font-size: 22px;"></p> <!-- 카페 한마디 -->
                <p><strong>주소:</strong> <span id="cafe-address"></span></p>
                <p><strong>영업 시간:</strong> <span id="cafe-opening-hours"></span></p> <!-- 영업 시간 -->
                <p><strong>권장 시간:</strong> <span id="cafe-hours"></span></p>
                <p><strong>아메리카노 가격:</strong> <span id="cafe-price"></span></p>
                <p><strong>좌석 및 콘센트 정보</strong></p>
                <table id="cafe-seating">
                    <thead>
                        <tr>
                            <th>좌석 종류</th>
                            <th>좌석 수</th>
                            <th>콘센트 좌석 수</th>
                        </tr>
                    </thead>
                    <tbody id="seating-info"></tbody>
                </table>
                <p><strong>카페 내부 영상 [분위기 & 소음]</strong></p>
                <video id="cafe-video" controls>
                    <source id="cafe-video-source" src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
        <!-- 지도 영역 -->
        <div id="map"></div>
    </div>

    <div id="chat-container">
        <div id="chat-messages"></div>
        <form id="chat-form">
            <input type="text" id="username" placeholder="사용자명" required>
        <br>
            <input type="text" id="message" placeholder="메시지를 입력하세요" required>
            <button type="submit">전송</button>
        </form>
    </div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0263a29ce4d7869fc8090d309d2bc371"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        var socket = io();

        // 연결 이벤트 처리
        socket.on('connect', function() {
            console.log('Connected to server');
            socket.emit('get_messages');
        });

        // 메시지 수신 이벤트 처리
        socket.on('receive_message', function(data) {
            var chatMessages = document.getElementById('chat-messages');
            var messageElement = document.createElement('div');
            messageElement.innerHTML = '<strong>' + data.username + ':</strong> ' + data.message;
            chatMessages.appendChild(messageElement);
        });

        // 채팅 메시지 목록 수신 이벤트 처리
        socket.on('chat_messages', function(messages) {
            var chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            messages.forEach(function(message) {
                var messageElement = document.createElement('div');
                messageElement.innerHTML = '<strong>' + message.username + ':</strong> ' + message.message;
                chatMessages.appendChild(messageElement);
            });
        });

        // 메시지 전송 폼 제출 이벤트 처리
        document.getElementById('chat-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var username = document.getElementById('username').value;
            var message = document.getElementById('message').value;
            socket.emit('send_message', {username: username, message: message});
            document.getElementById('message').value = '';
        });
    </script>
</body>
</html>
